<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Analysis Result</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        /* General Styling */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
            background: url('../static/img/Result.jpg') no-repeat center center fixed;
            background-size: cover;
            color: #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
        }

        /* Glass Effect */
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            padding: 20px;
            max-width: 90%;
            width: 1000px; /* Increased width */
            max-height: 80vh; /* Constrain height for large content */
            overflow-y: auto; /* Scroll for large content */
            margin: 20px;
        }

        /* Result Content */
        h1, h2, p {
            margin: 10px 0;
        }

        h1 {
            font-size: 2rem;
            text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.5);
        }

        h2 {
            font-size: 1.5rem;
            color: #ffffff;
            text-shadow: 1px 1px 5px rgba(0, 0, 0, 0.5);
        }

        p {
            font-size: 1.2rem;
            color: #ffffff;
            line-height: 1.6;
            word-wrap: break-word; /* Prevent overflow for long words */
            text-align: left; /* Align result text for readability */
        }

        /* Button */
        .submit-button {
            background-color: #007bff;
            color: #ffffff;
            padding: 12px 30px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin-top: 20px;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        .submit-button:hover {
            background-color: #0056b3;
            transform: scale(1.05);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .glass-effect {
                width: 95%;
                max-width: 100%;
            }

            h1 {
                font-size: 1.5rem;
            }

            h2 {
                font-size: 1.3rem;
            }

            p {
                font-size: 1rem;
            }
        }

        /* Navbar */
        .navbar {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: linear-gradient(145deg, #6a11cb, #2575fc);
            padding: 15px 25px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
            z-index: 10;
        }

        .navbar ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
        }

        .navbar ul li a {
            text-decoration: none;
            color: #ffffff;
            font-weight: 600;
            font-size: 1.1rem;
            padding: 10px 25px;
            border-radius: 12px;
            background: linear-gradient(90deg, #ff758c, #ff7eb3);
            transition: transform 0.3s ease, background 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .navbar ul li a:hover {
            background: linear-gradient(90deg, #ff4d6d, #ff758c);
            transform: scale(1.15);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        /* Location Selector Styling */
        .location-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .location-icon {
            color: #ffffff;
            font-size: 1.5rem;
        }

        .location-select {
            padding: 8px 15px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-family: 'Poppins', sans-serif;
            cursor: pointer;
            backdrop-filter: blur(5px);
        }

        .location-select option {
            background: #2c3e50;
            color: white;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <ul>
            <li><a href="/index">Home</a></li>
            <li><a href="/about">About</a></li>
            <li><a href="/features">Features</a></li>
            <li><a href="/contact">Contact</a></li>
            <li><a href="/home">Logout</a></li>
        </ul>
    </nav>

    <!-- Glass Effect Content -->
    <div class="glass-effect">
        <header>
            <div class="location-container">
                <i class="fas fa-map-marker-alt location-icon"></i>
                <select id="location" class="location-select" onchange="updateAnalysis()">
                    <option value="">Select Location</option>
                    <option value="Ariyalur">Ariyalur</option>
                    <option value="Chengalpattu">Chengalpattu</option>
                    <option value="Chennai">Chennai</option>
                    <option value="Coimbatore">Coimbatore</option>
                    <option value="Cuddalore">Cuddalore</option>
                    <option value="Dharmapuri">Dharmapuri</option>
                    <option value="Dindigul">Dindigul</option>
                    <option value="Erode">Erode</option>
                    <option value="Kallakurichi">Kallakurichi</option>
                    <option value="Kancheepuram">Kancheepuram</option>
                    <option value="Kanniyakumari">Kanniyakumari</option>
                    <option value="Karur">Karur</option>
                    <option value="Krishnagiri">Krishnagiri</option>
                    <option value="Madurai">Madurai</option>
                    <option value="Mayiladuthurai">Mayiladuthurai</option>
                    <option value="Nagapattinam">Nagapattinam</option>
                    <option value="Namakkal">Namakkal</option>
                    <option value="Nilgiris">Nilgiris</option>
                    <option value="Perambalur">Perambalur</option>
                    <option value="Pudukkottai">Pudukkottai</option>
                    <option value="Ramanathapuram">Ramanathapuram</option>
                    <option value="Ranipet">Ranipet</option>
                    <option value="Salem">Salem</option>
                    <option value="Sivaganga">Sivaganga</option>
                    <option value="Tenkasi">Tenkasi</option>
                    <option value="Thanjavur">Thanjavur</option>
                    <option value="Theni">Theni</option>
                    <option value="Thoothukudi">Thoothukudi</option>
                    <option value="Tiruchirappalli">Tiruchirappalli</option>
                    <option value="Tirunelveli">Tirunelveli</option>
                    <option value="Tirupathur">Tirupathur</option>
                    <option value="Tiruppur">Tiruppur</option>
                    <option value="Tiruvallur">Tiruvallur</option>
                    <option value="Tiruvannamalai">Tiruvannamalai</option>
                    <option value="Tiruvarur">Tiruvarur</option>
                    <option value="Vellore">Vellore</option>
                    <option value="Viluppuram">Viluppuram</option>
                    <option value="Virudhunagar">Virudhunagar</option>
                </select>
            </div>
            <h1>Business Analysis for:</h1>
            <p>"{{ query }}"</p>
        </header>
        <section>
            <h2>Analysis Result</h2>
            <!-- Display the result or error message -->
            <p>{{ response | safe }}</p>
        </section>        
        <footer>
            <a href="/index" class="submit-button">Go Back</a>
        </footer>
    </div>
    <script>
        function updateAnalysis() {
            const location = document.getElementById('location').value;
            const query = "{{ query }}";
            
            if (location && query) {
                fetch('/result', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `query=${encodeURIComponent(query)}&location=${encodeURIComponent(location)}`
                })
                .then(response => response.text())
                .then(html => {
                    document.documentElement.innerHTML = html;
                    // Restore the selected location
                    document.getElementById('location').value = location;
                });
            }
        }
        // Get the response text
        const response = "{{ response | safe }}";
        
        // Only reload if we're still waiting for a response
        if (response === "Reloading the page..." || response === "") {
            setTimeout(function() {
                location.reload();
            }, 1000);
        }
        
        // Stop reloading if we got an error response
        if (response.includes("Error") || response.includes("API key has insufficient balance")) {
            // Don't reload
        }
    </script>
    
</body>
</html>
